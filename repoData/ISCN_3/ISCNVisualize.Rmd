---
title: "ISCN viz"
author: "K Todd-Brown (ktoddbrown@gmail.com)"
date: "4/16/2017"
output:
  pdf_document: 
    fig_caption: yes
    toc: yes
  html_document: default
---

```{r setup}
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(plyr)
```

```{r loadData}
source('./processData_ISCN3.R')

ISCN3 <- processData_ISCN3(dir='.')
```


#Map of sites
```{r mapSites}

mapWorld <- borders("world", colour="gray80", fill="gray80") # create a layer of borders
#ggplot() + mapWorld
ggplot(unique(ISCN3$field[, c('lat', 'long')])) +
  mapWorld + 
  geom_hex(aes(x=long, y=lat), bins=200) + 
  scale_fill_gradient(trans='log10')
```

#Histograms of measurements
```{r types}
unique(ISCN3$measurement$type)
```

```{r BD}
ggplot(merge(subset(ISCN3$sample, grepl('^bd_', measurementID) & value > 0 & value < 10),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit)

summary(subset(ISCN3$sample, grepl('^bd_', measurementID) & (value < 0 | value > 10)))
```

```{r C_OC_LOI}
ggplot(merge(subset(ISCN3$sample, grepl('^(c_|oc|loi)', measurementID) & value > 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit)

summary(subset(ISCN3$sample, grepl('^(c_|oc|loi)', measurementID) & (value < 0)))
```

```{r N}
ggplot(merge(subset(ISCN3$sample, grepl('^n_', measurementID) & value > 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit)
```

```{r pH}
ggplot(merge(subset(ISCN3$sample, grepl('^ph_', measurementID) & value > 1.5),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  #scale_x_log10() + 
  facet_wrap(type~unit)

summary(subset(ISCN3$sample, grepl('^ph_', measurementID) & (value <= 1.5)))
```

```{r CaCO3}

ggplot(merge(subset(ISCN3$sample, grepl('^caco3', measurementID) & value > 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit)

summary(subset(ISCN3$sample, grepl('^caco3', measurementID) & (value <= 0)))

```

```{r Texture}

ggplot(merge(subset(ISCN3$sample, grepl('tot_psa', measurementID) & value >= 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  #scale_x_log10() + 
  facet_wrap(type~unit)

summary(subset(ISCN3$sample, grepl('tot_psa', measurementID) & (value < 0)))

```

```{r cat_wpg}

ggplot(merge(subset(ISCN3$sample, grepl('(cat_exch)', measurementID)& (value > 0)),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit)

summary(subset(ISCN3$sample, grepl('(cat_exch)', measurementID) & (value <= 0)))

subset(ISCN3$measurement,grepl('(cat_exch)', measurementID))
```

```{r wpg}
ggplot(merge(subset(ISCN3$sample, grepl('wpg2', measurementID) & value > 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit)

#summary(summary(subset(ISCN3$sample, grepl('wpg2', measurementID) & (value <= 0))))
```

```{r metals_percent}
ggplot(merge(subset(ISCN3$sample, 
                    grepl('^(al|fe|mn|ca|k|mg|na|p)_', measurementID) &
                      !grepl('ext', measurementID)),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit, scales='free')

summary(subset(ISCN3$sample, grepl('^(al|fe|mn|ca|k|mg|na|p)_', measurementID) &
                      !grepl('ext', measurementID) & (value > 100)))
```
```{r metals_ext}
ggplot(merge(subset(ISCN3$sample, grepl('ext', measurementID) & value > 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit, scales='free')

summary(subset(ISCN3$sample, grepl('ext', measurementID) & (value <= 0)))
```

```{r base_cec}
#base_sum     cec_sum      ecec         bs           bs_sum 
ggplot(merge(subset(ISCN3$sample, grepl('(base_sum|cec_sum|ecec)_', measurementID) & 
                      value > 0),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  scale_x_log10() + 
  facet_wrap(type~unit, scales='free')

summary(subset(ISCN3$sample, grepl('(base_sum|cec_sum|ecec)_', measurementID) & (value <= 0)))
```

```{r bs}
#bs           bs_sum 
ggplot(merge(subset(ISCN3$sample, grepl('^bs_', measurementID)),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  #scale_x_log10() + 
  facet_wrap(type~unit, scales='free')

#summary(subset(ISCN3$sample, grepl('^bs_', measurementID)))
```

```{r isotope}
#15n          13c          14c
ggplot(merge(subset(ISCN3$sample, grepl('^1[345]', measurementID)),
             ISCN3$measurement)) +
  geom_histogram(aes(x=value, y=..density..)) + 
  #scale_x_log10() + 
  facet_wrap(~type, scales='free')

summary(subset(ISCN3$sample, grepl('^1[345]', measurementID)))
```