---
title: "Data from C-PEAT"
author: "C-PEAT and Texas A&M Hackers"
date: "5/7/2018"
output: 
  html_document: 
    toc: yes
---

# Set Up
```{r setup}
library(tidyverse)

#mapping libraries to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

```

```{r download}
data.dir <- '~/Documents/Datasets/CPEAT/Data Hackathon TAMU 2018/'
#This will be filled in later when we have the data DOI links assigned
```

```{r eval=FALSE}
library(googledrive)
##pull all the files that we are working with for the hacakthon from the google drive
file.ls <- drive_ls(path='Professional/Data Hackathon TAMU 2018')
cat(sprintf('# %s \n\n', sort(file.ls$name)))
```

```{r readInCPEAT2018May}

readInCPEAT2018May <- function(filename, #where is the download
                               metaCol=1:2, #what rows define the metadata for the core
                               data01Col=5:14, #row index of non-isotope data for the core
                               data01nonNum=c('peat_type'), #what is not a number in the non-isotope
                               data02Col=17:23, #row index of isotope data
                               debug=FALSE){ #pass through a copy of the raw data read
  
  #big data table of everything without headers
  allData <- read_csv(file=filename, skip=1, col_names=FALSE, 
                      col_types=paste0(rep('c', max(c(metaCol, data01Col, data02Col))), collapse='')) 
  
  #initalize the list we'll pass the answer to
  ans <- list()
  
  #append the raw read if we are in debug mode
  if(debug){
    ans$rawRead <- allData
  }
  
  #There are no headers
  ans$site <- allData[,metaCol] #read first two columns as metadata
  names(ans$site) <- c('X1', 'X2') #force namings
  
  ans$site <- ans$site %>%
    filter(!is.na(X1) & !grepl('^\\s*$', X1)) %>% #remove empty rows
    spread(key=X1, value=X2) #convert table from long to wide
  
  #the rest of the data has a header, rename the columns
  names(allData) <- allData[1,]
  allData <- allData[-1,]
  
  #construct a table with the the depths
  depthTable <- allData[, data01Col] %>% 
    select(depth) %>% filter(!is.na(depth)) %>% 
    mutate(layer_mid=as.numeric(depth),
           layer_top=as.numeric(NA),
           layer_bottom=as.numeric(NA)) %>%
    arrange(layer_mid)
  
  depthTable$layer_top[1] <- 0
  depthTable$layer_bottom[1] <- depthTable$layer_mid[1]*2
  for(ii in 2:nrow(depthTable)){
    depthTable$layer_top[ii] <- depthTable$layer_bottom[ii-1]
    depthTable$layer_bottom[ii] <- (depthTable$layer_mid[ii]-depthTable$layer_top[ii]) + depthTable$layer_mid[ii]
  }
  
  ##Pull the non-isotope data table
  sampleData01 <- allData[, data01Col] %>%
    gather(key='header', value='value', -depth, -one_of(data01nonNum)) %>%
    #gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format exclude columns that are characters not numerics
    filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
    mutate(value=as.numeric(value)) %>% #make sure values are numerics
    left_join(depthTable, by='depth') %>%
    mutate(layer_name=paste(ans$site$core_name, depth, sep='_'))
  
  ##Pull the isotope data table
  sampleData02 <- allData[ ,data02Col] %>% #identify columns for age
    rename(header='date_type', 
           value='uncal_date_BP', 
           sigma='lab_uncertainty_yrs',
           depth='depth_cm') %>% #harmonize header names to match previous samples
    filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
    mutate(unit=if_else(grepl('A.D.$', value), 'non standard', 'date_BP'),
           layer_name=paste(ans$site$core_name, depth, sep='_'),
           layer_mid=as.numeric(depth),
           layer_top=as.numeric(depth)-as.numeric(thickness_cm)/2,
           layer_bottom=as.numeric(depth)+as.numeric(thickness_cm)/2) %>%
    mutate(value=gsub(' A.D.$', '', value)) %>% #break out so that we don't confuse unit def
    group_by(layer_name, header, layer_top, layer_bottom, value, sigma, unit) %>%
    gather(key='key', value='text', material, labe_code) %>%
    summarize(method = paste0(sprintf('%s: %s', key, text), collapse='; ')) %>%
    ungroup() %>%
    mutate(value=as.numeric(value),
           sigma=as.numeric(sigma))
  
  ##Construct the layer description to add to wide table
  layer_description <- sampleData01 %>% ungroup() %>%
    select(layer_name, layer_top, layer_bottom,
           one_of(c('peat_type'))) %>%
    full_join(sampleData02 %>% ungroup ()%>%
                select(layer_name, layer_top, layer_bottom), 
              by=c("layer_name", "layer_top", "layer_bottom")) %>%
    arrange(layer_top) %>% unique()
  
  ans$layer <- data.frame(layer_description, ans$site %>% select(site_name))
  
  ##construct long data table
  ans$sample <- sampleData01 %>%
    bind_rows(sampleData02) %>% #combine with previous samples
    select(layer_name, header, value, sigma, unit)
  
  
  return(ans)
}

temp <- readInCPEAT2018May(filename=file.path(data.dir, "Covey_Hill.csv"))
```

# Start here

1) Fork the main repository https://github.com/ISCN/SOC-DRaHR
2) Start by going to the master file and claiming a data file to work on. https://docs.google.com/spreadsheets/d/1hXyCW5TkLrt7en7tcz43lWHPxl5vVtG9qlkcr6t3zBs/edit?usp=sharing
3) Download your claimed data file from the google drive to a tempoary directory that you DO NOT commit to the repository https://drive.google.com/open?id=1k7CwjDePBuounwCMU1UFcWEsBlvwReWt
    - Do not commit data to the repository. The pull request will be denied.
4) Hack!
    1) Read in each table on the sheet
    2) If data is a soil measurement convert to a long table, otherwise keep wide
        - make sure entries are cross referenced and try to use informative unique ids
    3) Convert soil depth to top/bottom depth
    4) Convert to ISCN naming scheme and seperate units; see CPEAT_key.csv
    5) Plot data in histograms and map lat/lon; eyeball to make sure everything looks right
5) Add to your local git repository and push to your remote repository
6) Submit a pull request to the main repository
7) Claim your contributor status!
8) Repeat 1-6 until no data left

Remember to:

1) Steal shamelessly and credit generously.
2) Ask Google; then ask your neighbor; then ask an 'expert'.
3) Celebrate new and interesting mistakes.
4) There is ALWAYS more then one way to do something.
5) Document your code like you're passing it onto a dear friend to maintain.

## Useful notes
Any useful notes you find can go here for now: https://docs.google.com/document/d/1WeqesuFO--5AhQHQywNzdYSIoR9dctklhLjmCZy1chk/edit?usp=sharing
They will be transcribed to this document after the hackathon.

# Data ingest scripts

```{r loadFiles}

allFiles <- c( "86-Kvartal.csv", "Aero.csv", 
  "Altay.csv", "Bear.csv", "Burnt_Village.csv", "Covey_Hill.csv", #8
  "D127.csv", "E110.csv", "Ennadai.csv", "Glen_Carron.csv", #12
  "Glen_Torridon.csv", "Goldeye.csv", "HL02.csv", "Hongyuan.csv", #16
  "Horse_Trail.csv", "JBL1.csv", "JBL2.csv", "JBL3.csv", #20
  "JBL4.csv", "JBL5.csv", "JBL7.csv", "JBL8.csv", #24
  "Joey.csv", "KAM12-C1.csv", "KAM12-C4.csv", "Kenai_Gasfield.csv", #28
  "KJ2-3.csv", "KUJU.csv", "La_Grande2.csv", "La_Grande3.csv", #32
  "Lac_Le_Caron.csv", "Lake396.csv", "Lake785.csv", "Lebel.csv", #36
  "Lompolojankka.csv", "Mariana.csv", "Martin.csv", "Mosaik.csv", #40           
  "No_Name_Creek.csv", "Nuikluk.csv", "NW-BG.csv", "Ours.csv", #44
  "Patuanak.csv", "Petersville.csv", "Petite_Bog.csv", "Plaine.csv", #48
  "Rogovaya.csv", "Saarisuo.csv", "Selwyn.csv", "Shuttle.csv", #52
  "SIB06.csv", "Sidney.csv", "Siikaneva.csv", "Slave.csv", #56
  "Sterne.csv", "Stordalen.csv", "Sundance.csv", "Swanson.csv", #60
  "T1.csv", "Unit.csv", "Upper_Pinto.csv", "Usinsk.csv", #64
  "Utikuma.csv", "V34.csv", "Vasyugan.csv", "VC04-06.csv", #68
  "Zoige.csv")
questionable_date <- c('Covey_Hill.csv')
bad_header <- c('Burnt_Village.csv')
multiple_cores <- c('Joey.csv', 'Lebel.csv', 'Mariana.csv', 'Nuikluk.csv',
              'NW-BG.csv', 'Ours.csv', 'Plaine.csv', "Rogovaya.csv", "Sundance.csv")
ans <- list(long=data.frame(), wide=data.frame())
for(rootname in setdiff(allFiles, c(questionable_date, bad_header, multiple_cores))){
  temp <- readInCPEAT2018May(filename=file.path(data.dir, rootname), debug=TRUE)
  
  ans$sample <- ans$sample %>%
    bind_rows(temp$sample)
  ans$layer <- ans$layer %>%
    bind_rows(temp$layer)
  ans$site <- ans$site %>%
    bind_rows(temp$site)
}
```

```{r plotEverything}
plot.df <- ans$sample %>%
           left_join(ans$layer %>% select(layer_name, site_name), by='layer_name')

for(oneSite in ans$site$site_name[1:9]){

  print(ggplot(plot.df %>% filter(site_name==oneSite)) +
          #geom_histogram(data=plot.df %>% sample_n(sum(plot.df$site_name==oneSite)),
          #               aes(x=value), fill='grey') +
          geom_histogram(aes(x=value)) +
          facet_wrap(~header+unit, scales='free') +
          labs(title=oneSite)) 
  
  mapWorld <- borders("world", colour="gray80", fill="gray80") # create a layer of borders
  print(ggplot(ans$site %>% select(site_name, latitude, longitude) %>%
           #filter(site_name %in% ans$site$site_name[1:8]) %>%
           mutate_at(vars(latitude, longitude), as.numeric)) + 
    mapWorld +
    geom_point(aes(x=longitude, y=latitude)) +
    geom_point(aes(x=longitude[site_name==oneSite], y=latitude[site_name==oneSite]), color='red') +
    theme_bw() +
    theme(text=element_text(size=18),
          axis.title=element_blank()) +
    labs(title=oneSite))

}

problematicLayers <- ans$layer %>% filter(layer_top > layer_bottom) %>%
  select(site_name) %>% unique

ggplot(ans$layer %>% filter(site_name %in% problematicLayers$site_name[1:9])) +
  geom_point(aes(x=layer_top, y=layer_bottom)) +
  facet_wrap(~site_name, scales='free')

print(problematicLayers$site_name)
```

## 86-Kvartal.csv 

```{r 86-Kvartal}
dataFile <- '~/CPEAT_workshop/86-Kvartal.csv' #file path of data 
allData <- read_csv(file=dataFile, skip=1) #big data table of everything

metaData <- allData[,1:2] %>% #read first two columns as metadata
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>% #remove empty rows
  bind_rows(tibble(site_name='site_name', `86-Kvartal`='86-Kvartal')) %>% #transfers misidentified headers to data table
  spread(key=site_name, value='86-Kvartal') #convert table from long to wide

sampleData01 <- allData[ ,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format exclude columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value)) #remove missing values
  sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine with previous samples
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

#mapping libraries to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- borders("world", colour="gray80", fill="gray80") # create a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  mapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_bw() +
  theme(text=element_text(size=18),
        axis.title=element_blank())  
```


## Aero.csv 

## Altay.csv 

```{r Altay}
dataFile <- '~/CPEAT_workshop/Altay.csv' #file path of data 
allData <- read_csv(file=dataFile, skip=1) #big data table of everything

metaData <- allData[,1:2] %>% #read first two columns as metadata
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Altay='Altay')) %>% #transfers misidentified headers to data table
  spread(key=site_name, value=Altay) #convert table from long to wide

sampleData01 <- allData[ ,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format exclude columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value)) #remove missing values
  sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine with previous samples
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

#mapping libraries to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- borders("world", colour="gray80", fill="gray80") # create a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  mapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_bw() +
  theme(text=element_text(size=18),
        axis.title=element_blank())  
```


## Bear.csv 

## Burnt_Village.csv 

```{r Burnt_village}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/Burnt_Village.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Burnt_Village='Burnt_Village' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = Burnt_Village) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```

## Covey_Hill.csv 

## D127.csv 
```{r D127}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/D127.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', D127='D127' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = D127) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```

## E110.csv 

## Ennadai.csv 

## Glen_Carron.csv 

## Glen_Torridon.csv 
```{r Glen_Torridon}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/Glen_Torridon.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Glen_Torridon='Glen_Torridon' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = Glen_Torridon) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```


## Goldeye.csv 
```{r Goldeye}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/Goldeye.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Goldeye='Goldeye' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = Goldeye) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```

## HL02.csv 
```{r HL02}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/HL02.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', HL02='HL02' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = HL02) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```

## Hongyuan.csv 

## Horse_Trail.csv 

## JBL1.csv 

```{r JBL1}
datafile<-'~/Documents/JBL1/JBL1.csv'
allData<- read.csv(file=datafile, skip=1) #skip first row to avoid header

View(allData) #check to make sure it looks ok

metaData<- allData[, 1:2] %>% #pull just 1-2
    filter(!is.na(site_name) & !grepl ('^\\s*$', site_name)) %>% #remove empty rows 
    bind_rows((tibble(site_name = "site_name", JBL1 = 'JBL1'))) %>% 
     spread(key="site_name", value="JBL1") #exclude strings - anything thats not a numerical value 

View(metaData) #check to make sure it looks ok

grepl('^\\s*$', c('abc', '1234', 'asdfadc 13','', ' ', '\t')) #TEST 

sampleData01<- allData[, 5:14] %>% #identify columns for sample reads
    gather (key= 'header', value='value', -depth, -peat_type) %>% #convert to long format, exclude columns that are characters not numbers
    filter(!is.na(value) & !grepl('^\\s*$', value))%>% #remove empty rows
    mutate(value=as.numeric(value)) # make sure values are numeric
#peat type is all NA - fix at the end - use the peatland type listed in metaData "sphagnum_bog"

View(sampleData01) #check to make sure it looks ok


sampleData02<- allData[, 17:20] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl ('^\\s*$', value)) #remove empty rows
  


View(sampleData02) #check to make sure it looks ok
         
sampleData<- sampleData01 %>%
  bind_rows(sampleData02) %>% #combine with previous samples
  mutate(peat_type = metaData$peatland_type) #sets peatland type
#sweep and re run chunk to test


View(sampleData) #check to make sure it looks ok

```


## JBL2.csv 
```{r JBL2}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/JBL2.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', JBL2='JBL2' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = JBL2) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```

## JBL3.csv 
```{r JBL3}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/JBL3.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', JBL3='JBL3' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = JBL3) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```
## JBL4.csv 
```{r JBL4}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/JBL4.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', JBL4='JBL4' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = JBL4) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```
## JBL5.csv 
```{r JBL5}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/JBL5.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', JBL5='JBL5' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = JBL5) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```
## JBL7.csv 
```{r JBL7}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/JBL7.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', JBL7='JBL7' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = JBL7) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```
## JBL8.csv 
```{r JBL8}

dataFile <- 'C:/Users/Kritika/Documents/Hackathon/JBL8.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip =1) #big data table of everything!

metaData <- allData[,1:2] %>% #first two columns at meta data
  filter(!is.na(site_name) ) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', JBL8='JBL8' )) %>% #transfers miss-identified headers to data table
  spread(key=site_name, value = JBL8) #convert long to wide

sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format excludes columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))

sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with previous sample
  
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')


#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour='gray80', fill='gray80') #create a layer of borders

ggplot()+mapWorld

ggplot(metaData %>%
         mutate_at(vars(latitude,longitude), as.numeric))+
  mapWorld+
  geom_point(aes(x=longitude, y = latitude)) +
  theme_bw()+ 
  theme(text=element_text(size=18), axis.title=element_blank())

```
## Joey.csv 

## KAM12-C1.csv 

## KAM12-C4.csv 

## Kenai_Gasfield.csv 


```{r Kenai_Gasfield}


dataFile <- '~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Kenai_Gasfield.csv'
allData <- read_csv(file = dataFile, skip=1)
metaData <- allData[,1:2] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Kenai_Gasfield="Kenai_Gasfield",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Kenai_Gasfield)

sampleData <- allData[,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData <- allData[,17:23] %>%
  rename(header="date_type", value='uncal_date_BP', depth='depth_cm') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData)
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())
         

```
## KJ2-3.csv 

## KUJU.csv 

## La_Grande2.csv 

## La_Grande3.csv 

## Lac_Le_Caron.csv 

```{r Lac_Le_Caron}
dataFile <- '~/Documents/Science_et_al/C-PEAT/Lac_Le_Caron.csv' #data location on your computer

allData <- read.csv(file=dataFile, skip=1) #big data table of everything

metaData <- allData[,1:2] %>% 
#read first two columns as meta data
  filter(!is.na(site_name) & !grepl("^\\s*$", site_name)) %>% 
#remove empty rows
  bind_rows(data.frame(site_name='site_name', Lac_Le_Caron='Lac_Le_Caron', stringsAsFactors=FALSE)) %>%
#transfers miss-identified headers to data table
  spread(key=site_name, value=Lac_Le_Caron) #convert long to wide

#zero is the surface, 1 is the  
sampleData01 <- allData[ ,5:14] %>% 
#identify columns for sample reads 
  gather(key='header', value='value', -depth, -peat_type) %>% 
#convert to long format exclude columns that are characters not numerics
  filter(!is.na(value)) %>%
#remove missing values
  mutate(value=as.numeric(value))
#make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% 
#identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>%
#harmonize header names to match previous samples
  filter(!is.na(value))
  
sampleData <- sampleData01 %>%
  bind_rows(sampleData02)
#combine this with previous samples

ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')
#makes histograms for each column, as subplots in one figure  

```


## Lake396.csv 

## Lake785.csv 

## Lebel.csv 

## Lompolojankka.csv 

```{r Lompolojankka}


dataFile <- '~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Lompolojankka.csv'
allData <- read_csv(file = dataFile, skip=1)
metaData <- allData[,1:2] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Lompoloj_nkk_="Lompolojankka",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Lompoloj_nkk_)

sampleData <- allData[,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData <- allData[,17:23] %>%
  rename(header="date_type", value='uncal_date_BP', depth='depth_cm') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData)
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())
         

```
## Mariana.csv 

```{r Mariana}

##Core One

dataFile <- '~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Mariana.csv'
allData <- read_csv(file = dataFile, skip=1)
metaData_Core1 <- allData[,1:2] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Mariana="Mariana",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Mariana)

sampleData_Core1 <- allData[,7:16] %>%
  gather(key='header', value='value', -depth, -peat_type) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData_Core1 <- allData[,19:25] %>%
  rename(header="date_type", value='uncal_date_BP', depth='depth_cm') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData_Core1)
  
ggplot(sampleData_Core1) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData_Core1 %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())
         
##Core Two

metaData_Core2 <- allData[,c(1,3)] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Mariana_1="Mariana_1",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Mariana_1)

sampleData_Core2 <- allData[,28:37] %>%
  gather(key='header', value='value', -depth_1, -peat_type_1) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData_Core2 <- allData[,40:46] %>%
  rename(header="date_type_1", value='uncal_date_BP_1', depth='depth_cm_1') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData_Core2)

ggplot(sampleData_Core2) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld_Core2 <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData_Core2 %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld_Core2 +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())

##Core Three

metaData_Core3 <- allData[,c(1,4)] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Mariana_2="Mariana_2",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Mariana_2)

sampleData_Core3 <- allData[,49:58] %>%
  gather(key='header', value='value', -depth_2, -peat_type_2) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData_Core3 <- allData[,61:67] %>%
  rename(header="date_type_2", value='uncal_date_BP_2', depth='depth_cm_2') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData_Core3)

ggplot(sampleData_Core3) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld_Core3 <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData_Core3 %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld_Core3 +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())

```

## Martin.csv 
```{r Martin}
datafile <- "~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Martin.csv" #data location on local machine
allData <- read_csv(file = datafile, skip = 1) #giant data table of everything
metaData <- allData[,1:2] %>% #read first two columns as metadata
  filter(!is.na(site_name) & !grepl("^\\s*$", site_name)) %>% #remove empty rows
  bind_rows(data.frame(site_name = "site_name", Martin = "Martin", 
                       stringsAsFactors = FALSE)) %>% #transfers misidentified 
                                                      #...headers to data table
  spread(key = site_name, value = Martin) #convert long data to wide format

#
sampleData <- allData[,5:14] %>% #identify columns for sample reads
  gather(key = "header", value = "value", -depth) %>% #convert to long format
                                        #...format, exclude columns that 
                                        #...are characters (not numeric)
  filter(!is.na(value) & !grepl("^\\s*$", value)) %>% #remove missing values
  mutate(value = as.numeric(value)) #make sure values are numerics

sampleData <- allData[,17:23] %>% #identify columns for sample reads
  rename(header = "date_type", value = "uncal_date_BP", depth = "depth_cm") %>% #harmonize
                                            #...headernames to match previous samples
  filter(!is.na(value) & !grepl("^\\s*$", value)) %>% #remove missing values
  bind_rows(sampleData) #combine this with previous sample data table

#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", colour = "gray80", fill = "gray90")
        #create a border of the layers
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
          #change the lat and long from character to numeric
  mapWorld +
  geom_point(aes(x=longitude, y=latitude), color = "red", size = 2.5) +
  theme_classic() +
  theme(text = element_text(size=18),
                axis.title=element_blank())


```

##OR

```{r Martin}

dataFile <- '~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Martin.csv' #Data location on the computer
allData <- read_csv(file = dataFile, skip=1) #Creates a big data table
metaData <- allData[,1:2] %>% #Read in first two columns as metadata
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>% #Removes rows that have site_name & blanks
  bind_rows(data.frame(site_name="site_name", Martin="Martin", #makes a new dataframe
                       stringsAsFactors = FALSE)) %>%          #adds headers to the dataframe
  spread(key = site_name, value = Martin) #convert long to wide
  sampleData <- allData[,5:15] %>% #identifies columns for sample reads
    gather(key='header', value='value', -depth, -peat_type) %>% #convert wide to long format                                                              and excludes the selected columns
    filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #removes missing values
    mutate(value=as.numeric(value)) #make sure the values are numberic
  
sampleData <- allData[,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize headers
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%                                               #to match prev.
  bind_rows(sampleData) #combines this with previous samples

#Creates a histogram of the plot
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free') #creates subplots, has to be the same type of plot

#Visualization of site
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

MapWorld <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_bw()
theme(text=element_text(size=18),
      axis.title=element_blank())

```

## Mosaik.csv 
```{r Mosaik}
dataFile <- '~/CPEAT_workshop/Mosaik.csv' #file path of data 
allData <- read_csv(file=dataFile, skip=1) #big data table of everything

metaData <- allData[,1:2] %>% #read first two columns as metadata
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Mosaik='Mosaik'))   %>% #transfers misidentified headers to data table
  spread(key=site_name, value=Mosaik) #convert table from long to wide

sampleData01 <- allData[ ,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format exclude columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value)) #remove missing values
  sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine with previous samples

ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

#mapping libraries to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- borders("world", colour="gray80", fill="gray80") # create a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  mapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_bw() +
  theme(text=element_text(size=18),
        axis.title = element_blank())
```
=======

## Mariana.csv 

## Martin.csv 

## Mosaik.csv 

```{r Mosaik}
dataFile <- '~/Documents/Datasets/CPEAT/Mosaik.csv' #data location on your computer

allData <- read_csv(file=dataFile, skip=1) #big data table of everything!

metaData <- allData[,1:2] %>% #read first two columns as meta data
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Mosaik='Mosaik',
                       stringsAsFactors=FALSE)) %>% #transfers miss-identified
                                                    #...headers to data table
  spread(key=site_name, value=Mosaik) #convert long to wide

#zero is the surface, 1 is the 
sampleData01 <- allData[ ,5:14] %>% #identify columns for sample reads
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long
                    #...format exclude columns that are characters not numerics
  filter(!is.na(value) & ! grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics
  

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>%
                              #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value))
  
sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine this with pervious samples

ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales='free')

#mapping librarys to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- ggplot2::borders("world", 
                             colour='gray80', fill='gray80')# create a layer of borders

ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  mapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_bw() +
  theme(text=element_text(size=18),
        axis.title=element_blank())
```

## No_Name_Creek.csv 

## Nuikluk.csv 

## NW-BG.csv 

## Ours.csv 

## Patuanak.csv 

## Petersville.csv 

## Petite_Bog.csv 

## Plaine.csv 

## Rogovaya.csv
```{r Rogovaya}

##Core One

dataFile <- '~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Rogovaya.csv'
allData <- read_csv(file = dataFile, skip=1)
metaData_Core1 <- allData[,1:2] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Rogovaya="Rogovaya",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Rogovaya)

sampleData_Core1 <- allData[,6:15] %>%
  gather(key='header', value='value', -depth, -peat_type) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData_Core1 <- allData[,18:24] %>%
  rename(header="date_type", value='uncal_date_BP', depth='depth_cm') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData_Core1)
  
ggplot(sampleData_Core1) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData_Core1 %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())
         
##Core Two

metaData_Core2 <- allData[,c(1,3)] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Rogovaya_1="Rogovaya_1",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Rogovaya_1)

sampleData_Core2 <- allData[,27:36] %>%
  gather(key='header', value='value', -depth_1, -peat_type_1) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData_Core2 <- allData[,39:45] %>%
  rename(header="date_type_1", value='uncal_date_BP_1', depth='depth_cm_1') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData_Core2)

ggplot(sampleData_Core2) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld_Core2 <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData_Core2 %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld_Core2 +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())

```

## Saarisuo.csv 

## Selwyn.csv 

```{r Selwyn}


dataFile <- '~/Documents/Git_Workshop/SOC-DRaHR/hackathon/2018_May_CollegeStation_TX/Workshop/Selwyn.csv'
allData <- read_csv(file = dataFile, skip=1)
metaData <- allData[,1:2] %>%
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>%
  bind_rows(data.frame(site_name="site_name", Selwyn="Selwyn",
                       stringsAsFactors = FALSE)) %>%
  spread(key=site_name, value=Selwyn)

sampleData <- allData[,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  mutate(value=as.numeric(value))

sampleData <- allData[,17:23] %>%
  rename(header="date_type", value='uncal_date_BP', depth='depth_cm') %>%
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>%
  bind_rows(sampleData)
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

MapWorld <- ggplot2::borders("world", colour = "gray80", fill = "grey80") #creating a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  MapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_light()
theme(text=element_text(size=18),
      axis.title=element_blank())
         

```

## Shuttle.csv 

## SIB06.csv 

## Sidney.csv 

## Siikaneva.csv 

## Slave.csv 

## Sterne.csv 

## Stordalen.csv 

```{r Stordalen}
dataFile <- '~/CPEAT_workshop/Stordalen.csv' #file path of data 
allData <- read_csv(file=dataFile, skip=1) #big data table of everything

metaData <- allData[,1:2] %>% #read first two columns as metadata
  filter(!is.na(site_name) & !grepl('^\\s*$', site_name)) %>% #remove empty rows
  bind_rows(data.frame(site_name='site_name', Stordalen='Stordalen'))   %>% #transfers misidentified headers to data table
  spread(key=site_name, value=Stordalen) #convert table from long to wide

sampleData01 <- allData[ ,5:14] %>%
  gather(key='header', value='value', -depth, -peat_type) %>% #convert to long format exclude columns that are characters not numerics
  filter(!is.na(value) & !grepl('^\\s*$', value)) %>% #remove missing values
  mutate(value=as.numeric(value)) #make sure values are numerics

sampleData02 <- allData[ ,17:23] %>% #identify columns for age
  rename(header='date_type', value='uncal_date_BP', depth='depth_cm') %>% #harmonize header names to match previous samples
  filter(!is.na(value) & !grepl('^\\s*$', value)) #remove missing values
  sampleData <- sampleData01 %>%
  bind_rows(sampleData02) #combine with previous samples
  
ggplot(sampleData) +
  geom_histogram(aes(x=value)) +
  facet_wrap(~header, scales = 'free')

#mapping libraries to help with global/regional plots
library(ggmap)
library(maps)
library(mapdata)
library(fiftystater)

mapWorld <- borders("world", colour="gray80", fill="gray80") # create a layer of borders
ggplot(metaData %>%
         mutate_at(vars(latitude, longitude), as.numeric)) + 
  mapWorld +
  geom_point(aes(x=longitude, y=latitude)) +
  theme_bw() +
  theme(text=element_text(size=18),
        axis.title=element_blank())  
```


## Sundance.csv 

## Swanson.csv 

## T1.csv 

## Unit.csv 

## Upper_Pinto.csv 

## Usinsk.csv 

## Utikuma.csv 

## V34.csv 

## Vasyugan.csv 

## VC04-06.csv 

## Zoige.csv